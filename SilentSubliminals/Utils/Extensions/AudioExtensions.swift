//
//  AudioExtensions.swift
//  FREE UR SPIRIT
//
//  Created by Ullrich Vormbrock on 24.12.20.
//  Copyright Â© 2020 Ullrich Vormbrock. All rights reserved.
//

import CoreAudio
import AVFoundation

extension AVMutableCompositionTrack {
    
    func append(url: URL) {
        let newAsset = AVURLAsset(url: url)
        let range = CMTimeRangeMake(start: CMTime.zero, duration: newAsset.duration)
        let end = timeRange.end
        print(end)
        if let track = newAsset.tracks(withMediaType: AVMediaType.audio).first {
            try! insertTimeRange(range, of: track, at: end)
        }
    }
}

extension AVAudioFile {
    
    var duration: TimeInterval {
        let sampleRateSong = Double(processingFormat.sampleRate)
        let lengthSongSeconds = Double(length) / sampleRateSong
        print("**********************")
        print(length)
        return lengthSongSeconds
    }
}

extension AVAudioPlayerNode {
    
    var current: TimeInterval {
        if let nodeTime = lastRenderTime,let playerTime = playerTime(forNodeTime: nodeTime) {
            return Double(playerTime.sampleTime) / playerTime.sampleRate
        }
        return 0
    }
}

extension AVPlayer {
    
    var isPlaying2: Bool {
        return ((rate != 0) && (error == nil))
    }
}
